<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>服务列表</title>
    <link rel="stylesheet" type="text/css" href="http://unpkg.com/iview/dist/styles/iview.css">
    <style>
        .header {
            margin-top: 10px;
        }
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
        }
    </style>
</head>

<body>
<div id="app">
    <row class="header">
        <i-col>
            <breadcrumb separator="|">
                <breadcrumb-item>
                    <icon type="ios-home-outline"></icon> 铂金宫
                </breadcrumb-item>
                <breadcrumb-item>
                    <icon type="logo-buffer"></icon> 服务列表
                </breadcrumb-item>
            </breadcrumb>
        </i-col>
    </row>
    <!--表格-->
    <scroll :height="tableHeight" :on-reach-bottom="handleReachBottom" :distance-to-edge="20">
        <row class="content">
            <i-col>
                <div v-for="(data, index) in data_list" style="margin-bottom: 8px;">
                    <collapse simple>
                        <panel>
                            <strong>{{ data.name }}</strong> <span style="float: right; margin-right: 16px;">标准价: ¥ {{ data.price }}</span>
                            <p slot="content"> <expand-row :row="data"></expand-row> </p>
                        </panel>
                    </collapse>
                </div>
            </i-col>
        </row>
    </scroll>
    <row class="footer"><i-col> <span>铂金宫 @2018</span> </i-col></row>
</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.min.js"></script>
<script type="text/javascript" src="http://unpkg.com/iview/dist/iview.min.js"></script>
<script>
    Vue.component('ExpandRow', {
        props: {
            row: Object
        },
        template: '<div class="expand_row" style="margin-top: 8px; text-align: center">\n' +
            '        <Row style="margin-bottom: 8px">\n' +
            '            <Col>\n' +
            '               <icon type="ios-clock" /><strong>服务时长: </strong> <span>{{ row.duration }} 分钟</span>\n' +
            '            </Col>\n' +
            '        </Row>\n' +
            '        <Row>\n' +
            '            <Col>\n' +
            '               <icon type="logo-bitcoin" /><strong>会员价: </strong> <span>¥ {{ row.vipPrice }}</span>\n' +
            '            </Col>\n' +
            '        </Row>\n' +
            '    </div>',
    });
    let Main = {
        data () {
            return {
                data_list: [],
            }
        },
        computed: {
            tableHeight () {
                return $(window).height() * 0.9;
            }
        },
        methods: {
            handleReachBottom () {
                return new Promise(resolve => {
                    console.log('这里请求数据并push到data_list里');
                    resolve();
                });
            },
        },
        created() {
            var that = this;
            $.post("../php/getservice.php").done((result)=>{
                result = JSON.parse(result);
                if(result.status == 1){
                    var data = result.data;
                    for(var i = 0;i<data.length;i++){
                        that.data_list.push({
                            name:data[i].name,
                            price:data[i].price,
                            duration:data[i].duration,
                            vipPrice:data[i].price*result.max_discount
                        })
                    }
                }
            })
        },
    };
    let Component = Vue.extend(Main);
    new Component().$mount('#app');
</script>

</html>